<html>
<head>
  <link rel="stylesheet" href ="src/styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet" /> 
  <meta charset = "utf-8"/>
  <meta name = "viewport" content="width=device-width, initial-scale=1.0"/>
  <meta content="Установка KasmVNC в Debian на Android в Crosvm" name="title">
  <meta name="description" content="KasmVNC on Debian on Android in Crosvm">
  <meta name="keywords" content="kasmvnc debian android crosvm">
  <meta name="robots" content="index, follow"> <!-- Инструкции для поисковых роботов -->
  <title>Установка KasmVNC в Debian на Android в Crosvm</title>
</head>
<body>
  <header>
    <a href = "https://bvucode.github.io"><h1 class = "h1logo">BV</h1></a>
    <nav>
	<ul>
	    <li><a href = "https://bvucode.github.io">Home</a></li>
	</ul>
    </nav>
  </header>
  <div class="conteiner">
    <div class="content">
      <h2>Установка KasmVNC в Debian на Android в Crosvm</h2>
      <p>В этой статье подробно описывается процесс установки и настройки KasmVNC на операционной системе Debian, запущенной в среде Crosvm на устройстве Android.
         Описываемый метод является единственным надежным способом активации 3D-графики на телефонах, отличных от Google Pixel, которые не поддерживают Android Virtualization Framework (AVF).
		 Для достижения аппаратного ускорения графики при запуске Crosvm используются специальные флаги поддержки Virtio-GPU и virglrenderer.
         Примечание: На телефонах Google Pixel с Android 16 нативная поддержка аппаратного ускорения графики в Linux-терминале.
         KasmVNC — это современный сервер VNC, обеспечивающий плавный и безопасный удаленный рабочий стол. Он основан на улучшенной версии TigerVNC и оптимизирован для облачных и современных веб-технологий,
		 предлагая повышенную производительность, безопасность и удобство использования.</p>
       <h3>Обновление системы</h3>
          <pre><code>
             sudo apt update
             sudo apt upgrade
          </code></pre>
		<h3>Установка среды рабочего стола и зависимостей</h3>
          <p>Необходимо настроить среду рабочего стола для запуска и установить необходимые зависимости. Мы будем использовать легкую среду рабочего стола Xfce4.</p>
          <pre><code>
             sudo apt install xfce4 xfce4-terminal xfce4-goodies dbus-x11 wget
          </code></pre>
		<h3>Загрузка и установка KasmVNC</h3>
          <p>Скачать и установить KasmVNC</p>
          <pre><code>
             wget https://github.com/kasmtech/KasmVNC/releases/download/v1.3.4/kasmvncserver_bookworm_1.3.4_arm64.deb
             sudo apt-get install ./kasmvncserver_bookworm_1.3.4_arm64.deb
          </code></pre>
          <p>Если во время процесса установки существует проблема зависимости, вы можете запустить следующую команду для решения.</p>
          <pre><code>
             sudo apt --fix-broken install
          </code></pre>
        <h3>Инициализируйте конфигурацию KasmVNC</h3>
          <p>Запустите следующую команду для инициализации конфигурации KasmVNC</p>
          <pre><code>
             kasmvncserver
          </code></pre>
          <p>Когда вы впервые запустите эту команду, вы увидите следующую подсказку</p>
          <pre><code>
             Creating default config /root/.vnc/kasmvnc.yaml
             xauth:
             file /root/.Xauthority does not exist
             In order to control your desktop, you need a KasmVNC user with write
             permissions. Select what action to take:
             [1] Create a new user with write access
             [2] Start KasmVNC without a user with write access
          </code></pre>
          <p>Выберите опцию [1], чтобы создать нового пользователя с разрешениями на запись. Это обеспечит необходимые права для управления рабочим столом. Вам будет предложено ввести имя пользователя и пароль.
			 После создания пользователя и запуска сервера вы увидите информацию о сессии:</p>
          <pre><code>
             New 'US706980102097:1 (root)' desktop is US706980102097:1
             Users configured:
             root (can use keyboard and mouse)
             Log file is /root/.vnc/US706980102097:1.log
             Creating default startup script /root/.vnc/xstartup
             Starting applications specified in /root/.vnc/xstartup
             Paste this url in your browser:
             https://127.0.1.1:8444
          </code></pre>
          <p>Этот выход содержит несколько важных частей информации</p>
          <ol>
              <li>KasmVNC успешно создала новую сессию рабочего стола</li>
              <li>Расположение файла журнала:/root/.vnc/US706980102097:1.log</li>
              <li>Расположение скрипта запуска по умолчанию:/root/.vnc/xstartup</li>
              <li>URL для доступа в браузере: https://127.0.1.1:8444</li>
          </ol>
          <p>Для начала новой сессии KasmVNC можно использовать следующую команду</p>
          <pre><code>
             vncserver
          </code></pre>
          <p>Управление сессиями KasmVNC</p>
          <p>Для просмотра текущей сессии VNC можно использовать следующую команду</p>
          <pre><code>
             vncserver -list
          </code></pre>
          <p>Если вы хотите остановить определенный сеанс VNC, вы можете использовать следующую команду</p>
          <pre><code>
             vncserver -kill :1
          </code></pre>
          <p>Здесь :1 — это номер сеанса, который вы можете увидеть в выводе команды -list.</p>
		  <p>Если вы успешно подключились к веб-интерфейсу, но видите только черный экран, это означает, что среда рабочего стола Xfce4 не была запущена корректно.</p>
		  <p>Редактируте файл скрипта запуска VNC</p>
          <pre><code>
             nvim ~/.vnc/xstartup
          </code></pre>
          <p>Заменить содержание документа следующим</p>
          <pre><code>
             #!/bin/bash
             unset SESSION_MANAGER
             unset DBUS_SESSION_BUS_ADDRESS
             export XKL_XMODMAP_DISABLE=1
             export XDG_SESSION_TYPE=x11
             export GDK_BACKEND=x11
             xfce4-session &
          </code></pre>
          <p>Убедитесь, что скрипт запуска имеет разрешения на выполнение</p>
          <pre><code>
             chmod +x ~/.vnc/xstartup
          </code></pre>
          <p>Перезапуск VNC</p>
          <pre><code>
             vncserver -kill :1
             vncserver
          </code></pre>
		  <p>Подключение осуществляется через веб-браузер на вашем Android-устройстве по адресу: https://127.0.1.1:8444.
			 Если вы не можете получить доступ по адресу https://127.0.1.1:8444,
			 используйте IP-адрес, назначенный гостевой ОС Debian (например, https://192.168.10.2:8444).
		     Вы можете узнать этот адрес с помощью команды ip a .
		  </p>
        <h3>Автоматический запуск KasmVNC при загрузке (systemd)</h3>
          <p>Если вы хотите, чтобы KasmVNC запускался автоматически при старте системы Debian, можно создать системную службу systemd.</p>
          <pre><code>
             sudo nvim /etc/systemd/system/kasmvnc.service
          </code></pre>
          <p>Добавьте следующее содержимое:Важно: Замените your_username на ваше реальное имя пользователя (например, root).</p>
          <pre><code>
             [Unit]
             Description=KasmVNC Server
             After=network.target
             [Service]
             Type=forking
             User=your_username
             ExecStart=/usr/bin/vncserver
             ExecStop=/usr/bin/vncserver -kill :1
             [Install]
             WantedBy=multi-user.target
          </code></pre>
          <p>Затем включить и запустить услугу</p>
          <pre><code>
             sudo systemctl enable kasmvnc.service
             sudo systemctl start kasmvnc.service
          </code></pre>
          <p>KasmVNC теперь будет работать автоматически, когда система запускается</p>
		<h3>Настройка SSL-сертификата (Устранение ошибки)</h3>
          <p>Если при попытке подключения вы столкнулись с ошибкой /etc/ssl/private/ssl-cert-snakeoil.key: сертификата не существует или
			 не является файлом, это означает, что KasmVNC не может найти сертификат SSL по умолчанию. Вы можете создать самоподписанный сертификат,
			 выполнив следующие действия:</p>
          <p>Установите пакет ssl-cert</p>
          <pre><code>
             sudo apt install ssl-cert
          </code></pre>
          <p>Создайте самоподписанный сертификат</p>
          <pre><code>
             sudo make-ssl-cert generate-default-snakeoil --force-overwrite
          </code></pre>
          <p>Убедитесь, что KasmVNC имеет доступ к этим файлам</p>
          <pre><code>
             sudo chmod 644 /etc/ssl/certs/ssl-cert-snakeoil.pem
             sudo chmod 640 /etc/ssl/private/ssl-cert-snakeoil.key
             sudo chown root:ssl-cert /etc/ssl/private/ssl-cert-snakeoil.key
          </code></pre>
          <p>Добавьте пользователя в группу ssl-cert</p>
          <pre><code>
             sudo usermod -a -G ssl-cert $USER
          </code></pre>
          <p>Чтобы изменения группы вступили в силу, выполните:</p>
          <pre><code>
             newgrp ssl-cert
          </code></pre>
          <p>Перезапустить сервис KasmVNC</p>
          <pre><code>
             vncserver -kill :1
             vncserver
          </code></pre>
          <p>Эти шаги должны решить проблему SSL-сертификатов. Теперь вы можете получить доступ к KasmVNC через свой веб-браузер.
			 Введите в браузере: https://your_server_ip:8444 (например, https://192.168.10.2:8444).</p>
          <p>Введите пароль VNC</p>
		<h3>Дополнительные советы по устранению проблем</h3>
          <p>Если у вас возникли проблемы с запуском среды рабочего стола, вы можете просмотреть файл журнала VNC (обычно расположенный
          по адресу ~/.vnc/*.log для получения дополнительной информации.</p>
          <p>Убедитесь, что переменная среды DISPLAY установлена правильно</p>
          <pre><code>
             echo $DISPLAY
          </code></pre>
          <p>Если выход неверный, установите его</p>
          <pre><code>
             export DISPLAY=:1
          </code></pre>
          <p>Перезапуск VNC</p>
          <pre><code>
             vncserver -kill :1
             vncserver
          </code></pre>
          <p>С помощью вышеуказанных шагов вы успешно установили и настроили KasmVNC на Debian.
          Если вы столкнулись с какими-либо проблемами во время установки или использования, вы можете ознакомиться с официальной
          документацией KasmVNC или обратиться за помощью в его репозитории GitHub.
       </p>
      </div>
  </div>
  <div id="footer">
    <p>Copyright &copy; 2025 All right reserved.</p>
  </div>
</body>
</html>
